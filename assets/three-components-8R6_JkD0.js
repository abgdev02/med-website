import{r as E,j as kt,u as Ft}from"./react-three-BfNcPNxo.js";import{i as Pt,j as nt,k as Gt,l as Ot,m as Tt,d as Rt}from"./three-DBck7CmY.js";import{L as _t,F as qt,S as Qt,g as J,a as rt}from"./utils-DI-WTg4b.js";class Xt{constructor(o=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(o.random()*256);this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[t&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(o,t,n){return o[0]*t+o[1]*n}dot3(o,t,n,a){return o[0]*t+o[1]*n+o[2]*a}dot4(o,t,n,a,l){return o[0]*t+o[1]*n+o[2]*a+o[3]*l}noise(o,t){let n,a,l;const r=.5*(Math.sqrt(3)-1),s=(o+t)*r,c=Math.floor(o+s),e=Math.floor(t+s),i=(3-Math.sqrt(3))/6,f=(c+e)*i,S=c-f,M=e-f,v=o-S,w=t-M;let j,P;v>w?(j=1,P=0):(j=0,P=1);const u=v-j+i,h=w-P+i,d=v-1+2*i,b=w-1+2*i,T=c&255,C=e&255,z=this.perm[T+this.perm[C]]%12,p=this.perm[T+j+this.perm[C+P]]%12,g=this.perm[T+1+this.perm[C+1]]%12;let x=.5-v*v-w*w;x<0?n=0:(x*=x,n=x*x*this.dot(this.grad3[z],v,w));let y=.5-u*u-h*h;y<0?a=0:(y*=y,a=y*y*this.dot(this.grad3[p],u,h));let D=.5-d*d-b*b;return D<0?l=0:(D*=D,l=D*D*this.dot(this.grad3[g],d,b)),70*(n+a+l)}noise3d(o,t,n){let a,l,r,s;const e=(o+t+n)*.3333333333333333,i=Math.floor(o+e),f=Math.floor(t+e),S=Math.floor(n+e),M=1/6,v=(i+f+S)*M,w=i-v,j=f-v,P=S-v,u=o-w,h=t-j,d=n-P;let b,T,C,z,p,g;u>=h?h>=d?(b=1,T=0,C=0,z=1,p=1,g=0):u>=d?(b=1,T=0,C=0,z=1,p=0,g=1):(b=0,T=0,C=1,z=1,p=0,g=1):h<d?(b=0,T=0,C=1,z=0,p=1,g=1):u<d?(b=0,T=1,C=0,z=0,p=1,g=1):(b=0,T=1,C=0,z=1,p=1,g=0);const x=u-b+M,y=h-T+M,D=d-C+M,q=u-z+2*M,Q=h-p+2*M,X=d-g+2*M,Y=u-1+3*M,$=h-1+3*M,k=d-1+3*M,O=i&255,R=f&255,_=S&255,tt=this.perm[O+this.perm[R+this.perm[_]]]%12,et=this.perm[O+b+this.perm[R+T+this.perm[_+C]]]%12,st=this.perm[O+z+this.perm[R+p+this.perm[_+g]]]%12,ot=this.perm[O+1+this.perm[R+1+this.perm[_+1]]]%12;let I=.6-u*u-h*h-d*d;I<0?a=0:(I*=I,a=I*I*this.dot3(this.grad3[tt],u,h,d));let L=.6-x*x-y*y-D*D;L<0?l=0:(L*=L,l=L*L*this.dot3(this.grad3[et],x,y,D));let F=.6-q*q-Q*Q-X*X;F<0?r=0:(F*=F,r=F*F*this.dot3(this.grad3[st],q,Q,X));let G=.6-Y*Y-$*$-k*k;return G<0?s=0:(G*=G,s=G*G*this.dot3(this.grad3[ot],Y,$,k)),32*(a+l+r+s)}noise4d(o,t,n,a){const l=this.grad4,r=this.simplex,s=this.perm,c=(Math.sqrt(5)-1)/4,e=(5-Math.sqrt(5))/20;let i,f,S,M,v;const w=(o+t+n+a)*c,j=Math.floor(o+w),P=Math.floor(t+w),u=Math.floor(n+w),h=Math.floor(a+w),d=(j+P+u+h)*e,b=j-d,T=P-d,C=u-d,z=h-d,p=o-b,g=t-T,x=n-C,y=a-z,D=p>g?32:0,q=p>x?16:0,Q=g>x?8:0,X=p>y?4:0,Y=g>y?2:0,$=x>y?1:0,k=D+q+Q+X+Y+$,O=r[k][0]>=3?1:0,R=r[k][1]>=3?1:0,_=r[k][2]>=3?1:0,tt=r[k][3]>=3?1:0,et=r[k][0]>=2?1:0,st=r[k][1]>=2?1:0,ot=r[k][2]>=2?1:0,I=r[k][3]>=2?1:0,L=r[k][0]>=1?1:0,F=r[k][1]>=1?1:0,G=r[k][2]>=1?1:0,bt=r[k][3]>=1?1:0,ct=p-O+e,at=g-R+e,it=x-_+e,lt=y-tt+e,ut=p-et+2*e,ht=g-st+2*e,mt=x-ot+2*e,ft=y-I+2*e,dt=p-L+3*e,pt=g-F+3*e,gt=x-G+3*e,Mt=y-bt+3*e,wt=p-1+4*e,xt=g-1+4*e,yt=x-1+4*e,St=y-1+4*e,Z=j&255,A=P&255,N=u&255,H=h&255,zt=s[Z+s[A+s[N+s[H]]]]%32,Dt=s[Z+O+s[A+R+s[N+_+s[H+tt]]]]%32,Et=s[Z+et+s[A+st+s[N+ot+s[H+I]]]]%32,It=s[Z+L+s[A+F+s[N+G+s[H+bt]]]]%32,Lt=s[Z+1+s[A+1+s[N+1+s[H+1]]]]%32;let U=.6-p*p-g*g-x*x-y*y;U<0?i=0:(U*=U,i=U*U*this.dot4(l[zt],p,g,x,y));let V=.6-ct*ct-at*at-it*it-lt*lt;V<0?f=0:(V*=V,f=V*V*this.dot4(l[Dt],ct,at,it,lt));let W=.6-ut*ut-ht*ht-mt*mt-ft*ft;W<0?S=0:(W*=W,S=W*W*this.dot4(l[Et],ut,ht,mt,ft));let K=.6-dt*dt-pt*pt-gt*gt-Mt*Mt;K<0?M=0:(K*=K,M=K*K*this.dot4(l[It],dt,pt,gt,Mt));let B=.6-wt*wt-xt*xt-yt*yt-St*St;return B<0?v=0:(B*=B,v=B*B*this.dot4(l[Lt],wt,xt,yt,St)),27*(i+f+S+M+v)}}const vt=new Xt,jt=new _t(50),Yt=()=>{const m=document.createElement("canvas");m.width=128,m.height=128;const o=m.getContext("2d"),t=o.createImageData(128,128);for(let c=0;c<t.data.length;c+=4){const e=Math.random(),i=Math.floor(220+e*10);t.data[c]=i-1,t.data[c+1]=i,t.data[c+2]=i+1,t.data[c+3]=255}o.putImageData(t,0,0);const n=new Pt(m);n.wrapS=nt,n.wrapT=nt,n.repeat.set(1.2,1.2);const a=document.createElement("canvas");a.width=64,a.height=64;const l=a.getContext("2d"),r=l.createImageData(64,64);for(let c=0;c<r.data.length;c+=4)r.data[c]=Math.floor(128+(Math.random()-.5)*8),r.data[c+1]=Math.floor(128+(Math.random()-.5)*8),r.data[c+2]=Math.floor(220+Math.random()*20),r.data[c+3]=255;l.putImageData(r,0,0);const s=new Pt(a);return s.wrapS=nt,s.wrapT=nt,{colorTexture:n,normalTexture:s}},Ct=Yt();function $t({distance:m=10,quality:o="medium",enableTextures:t=!0,isStatic:n=!1}={}){const a=E.useRef(null),l=E.useMemo(()=>({low:m>30?[.8,12,8]:[.8,16,12],medium:m>30?[.8,20,14]:[.8,32,24],high:m>30?[.8,32,24]:[.8,48,32]})[o],[m,o]),r=E.useMemo(()=>{const c=`${l.join("-")}-${m}-${n}`;if(jt.has(c))return jt.get(c).clone();const e=new Gt(...l);if(!n){const i=e.attributes.position,f=m>25?.008:.015,S=m>25?.3:.4,M=m>25?.8:1.2,v=.92;for(let w=0;w<i.count;w++){const j=i.getX(w),P=i.getY(w),u=i.getZ(w);let h;if(m>25)h=vt.noise3d(j*S,P*S,u*S);else{const d=vt.noise3d(j*S,P*S,u*S)*.8,b=vt.noise3d(j*M,P*M,u*M)*.2;h=d+b}i.setXYZ(w,j+h*f*Math.abs(j),P*v+h*f*.1,u+h*f*Math.abs(u))}i.needsUpdate=!0,e.computeVertexNormals()}return jt.set(c,e),e.clone()},[l,m,n]),s=E.useMemo(()=>{const c={color:new Ot(.98,.98,.98),roughness:.8,metalness:.02,envMapIntensity:.12};return t&&m<25?new Tt({...c,map:Ct.colorTexture,normalMap:Ct.normalTexture,normalScale:new Rt(.3,.3)}):new Tt(c)},[m,t]);return E.useEffect(()=>{a.current&&r&&(a.current.geometry=r)},[r]),kt.jsx("mesh",{ref:a,material:s,castShadow:!0,receiveShadow:!0,children:kt.jsx("sphereGeometry",{args:l})})}const Ut=Object.freeze(Object.defineProperty({__proto__:null,ProceduralPebble:$t},Symbol.toStringTag,{value:"Module"}));function Zt(){const{scene:m,camera:o}=Ft(),t=E.useRef(),n=E.useRef();return E.useEffect(()=>(t.current=new qt,n.current=new Qt(50),console.log("ðŸŽ¯ Scene Manager: Spatial systems initialized"),()=>{t.current=void 0,n.current=void 0}),[o]),E.useEffect(()=>{const a="scene-manager-optimization";return J.addTask({id:a,priority:8,updateInterval:100,callback:()=>{if(!t.current||!n.current)return;rt.update();const l=rt.getPerformanceLevel(),r=l==="low",s=l==="high";t.current.updateCamera(o);const c=t.current.cullObjects();n.current.clear(),c.visible.forEach(e=>{e.object.position&&n.current.insert(e.id,e.object.position)}),m.traverse(e=>{if(e.userData.isOptimizable){const i=o.position.distanceTo(e.position);let f;r?f=i>20?"low":"medium":s?f=i>30?"medium":"high":f=i>25?"low":i>15?"medium":"high",e.userData.updateQuality&&e.userData.currentQuality!==f&&(e.userData.updateQuality(f),e.userData.currentQuality=f)}})}}),()=>{J.removeTask(a)}},[m,o]),E.useEffect(()=>{const a=setInterval(()=>{var s;const l=rt.getPerformanceLevel(),r=J.getFrameStats();console.log("ðŸ”§ Performance Metrics:",{"Performance Level":l,"Animation Efficiency":Math.round(r.efficiency*100)+"%","Scheduler Tasks":J.getTaskCount(),"Spatial Objects":((s=n.current)==null?void 0:s.getStats().totalObjects)||0})},5e3);return()=>clearInterval(a)},[]),E.useEffect(()=>{window.sceneDebug={frustumCuller:t.current,spatialGrid:n.current,getPerformanceLevel:()=>rt.getPerformanceLevel(),getSchedulerStats:()=>J.getFrameStats()}},[]),null}const Vt=Object.freeze(Object.defineProperty({__proto__:null,SceneManager:Zt},Symbol.toStringTag,{value:"Module"}));export{$t as P,Vt as S,Ut as a};
